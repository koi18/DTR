// Add these variables at the top of your script
let currentPage = 1;
const recordsPerPage = 5;
let totalRecords = 0;

function setupPagination(records) {
    const totalPages = Math.ceil(records.length / recordsPerPage);
    totalRecords = records.length;
    
    const paginationContainer = document.createElement('div');
    paginationContainer.className = 'pagination-container';
    
    // Add pagination info
    const paginationInfo = document.createElement('div');
    paginationInfo.className = 'pagination-info';
    paginationInfo.textContent = `Showing ${Math.min(recordsPerPage, records.length)} of ${records.length} entries`;
    
    // Create pagination controls
    const paginationControls = document.createElement('div');
    paginationControls.className = 'pagination-controls';
    
    // Previous button
    const prevButton = document.createElement('button');
    prevButton.textContent = 'Previous';
    prevButton.className = 'pagination-btn';
    prevButton.disabled = currentPage === 1;
    prevButton.onclick = () => {
        if (currentPage > 1) {
            currentPage--;
            displayRecords();
        }
    };
    
    // Next button
    const nextButton = document.createElement('button');
    nextButton.textContent = 'Next';
    nextButton.className = 'pagination-btn';
    nextButton.disabled = currentPage === totalPages;
    nextButton.onclick = () => {
        if (currentPage < totalPages) {
            currentPage++;
            displayRecords();
        }
    };
    
    // Page numbers
    const pageNumbers = document.createElement('div');
    pageNumbers.className = 'page-numbers';
    
    for (let i = 1; i <= totalPages; i++) {
        const pageButton = document.createElement('button');
        pageButton.textContent = i;
        pageButton.className = `page-number ${currentPage === i ? 'active' : ''}`;
        pageButton.onclick = () => {
            currentPage = i;
            displayRecords();
        };
        pageNumbers.appendChild(pageButton);
    }
    
    // Assemble pagination controls
    paginationControls.appendChild(prevButton);
    paginationControls.appendChild(pageNumbers);
    paginationControls.appendChild(nextButton);
    
    // Assemble pagination container
    paginationContainer.appendChild(paginationInfo);
    paginationContainer.appendChild(paginationControls);
    
    // Add pagination container after the table
    const table = document.querySelector('#dtrTableBody').closest('table');
    table.parentNode.insertBefore(paginationContainer, table.nextSibling);
}

function displayRecords() {
    const dtrRecords = JSON.parse(localStorage.getItem('dtrRecords') || '[]');
    const tbody = document.getElementById('dtrTableBody');
    tbody.innerHTML = '';
    
    const start = (currentPage - 1) * recordsPerPage;
    const end = start + recordsPerPage;
    const paginatedRecords = dtrRecords.slice(start, end);
    
    paginatedRecords.forEach((record, index) => {
        createTableRow(record, start + index, tbody);
    });
    
    // Update pagination UI
    updatePaginationUI(dtrRecords.length);
}

function updatePaginationUI(totalRecords) {
    const totalPages = Math.ceil(totalRecords / recordsPerPage);
    const paginationContainer = document.querySelector('.pagination-container');
    
    if (paginationContainer) {
        // Update info text
        const start = (currentPage - 1) * recordsPerPage + 1;
        const end = Math.min(currentPage * recordsPerPage, totalRecords);
        const infoText = `Showing ${start}-${end} of ${totalRecords} entries`;
        paginationContainer.querySelector('.pagination-info').textContent = infoText;
        
        // Update button states
        const prevButton = paginationContainer.querySelector('.pagination-btn:first-child');
        const nextButton = paginationContainer.querySelector('.pagination-btn:last-child');
        prevButton.disabled = currentPage === 1;
        nextButton.disabled = currentPage === totalPages;
        
        // Update page numbers
        const pageNumbers = paginationContainer.querySelectorAll('.page-number');
        pageNumbers.forEach((btn, index) => {
            btn.className = `page-number ${currentPage === index + 1 ? 'active' : ''}`;
        });
    }
}

// Modify the window load event listener to include pagination
window.addEventListener('load', function() {
    const dtrRecords = JSON.parse(localStorage.getItem('dtrRecords') || '[]');
    setupPagination(dtrRecords);
    displayRecords();
});

// Add this CSS to your stylesheet
const style = document.createElement('style');
style.textContent = `
.pagination-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
    padding: 10px;
}

.pagination-info {
    color: #666;
}

.pagination-controls {
    display: flex;
    gap: 10px;
    align-items: center;
}

.pagination-btn {
    padding: 8px 16px;
    border: 1px solid #ddd;
    background-color: #fff;
    cursor: pointer;
    border-radius: 4px;
}

.pagination-btn:disabled {
    background-color: #f5f5f5;
    cursor: not-allowed;
}

.page-numbers {
    display: flex;
    gap: 5px;
}

.page-number {
    padding: 8px 12px;
    border: 1px solid #ddd;
    background-color: #fff;
    cursor: pointer;
    border-radius: 4px;
}

.page-number.active {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
}

.pagination-btn:hover:not(:disabled),
.page-number:hover:not(.active) {
    background-color: #f0f0f0;
}
`;
document.head.appendChild(style);
